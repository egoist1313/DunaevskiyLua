script_name('Level')
script_version('07/03/2025')
script_properties("work-in-pause")
require "lib.moonloader"
local imgui = require 'imgui'
local encoding = require 'encoding'
encoding.default = 'CP1251'
local u8 = encoding.UTF8

-- Окно ImGui
local showSettings = imgui.ImBool(false)

-- Проверка загрузки ImGui
if imgui == nil then
    print("Ошибка: ImGui не загружен")
    return
end

function main()
    if not isSampLoaded() or not isSampfuncsLoaded() then
        print("Ошибка: SA:MP или sampfuncs не загружены")
        return
    end
    while not isSampAvailable() do wait(100) end

    -- Регистрация команды /level
    sampRegisterChatCommand('level', function()
        showSettings.v = not showSettings.v
        sampAddChatMessage("[Level] Окно настроек: " .. tostring(showSettings.v), 0xFFFF00)
    end)

    imgui.Process = true
    while true do
        wait(0)
        imgui.Process = showSettings.v
    end
end

-- ImGui интерфейс
imgui.OnDrawFrame = function()
    if showSettings.v then
        imgui.ShowCursor = true
        local screenX, screenY = getScreenResolution()
        imgui.SetNextWindowSize(imgui.ImVec2(400, 300), imgui.Cond.FirstUseEver)
        imgui.SetNextWindowPos(imgui.ImVec2(screenX / 2, screenY / 2), imgui.Cond.FirstUseEver, imgui.ImVec2(0.5, 0.5))
        imgui.Begin(u8'Настройки Level', showSettings, imgui.WindowFlags.NoCollapse)
        imgui.Text(u8'Тестовое окно Level')
        imgui.Separator()
        if imgui.Button(u8'Закрыть') then
            showSettings.v = false
        end
        imgui.End()
    end
end